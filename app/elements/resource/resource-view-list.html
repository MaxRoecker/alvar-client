<dom-module is="resource-view-list">
  <link rel="import" href="../../../bower_components/polymer/polymer.html" />
  <link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html" />
  <link rel="import" href="../../../bower_components/paper-header-panel/paper-header-panel.html" />
  <link rel="import" href="../../../bower_components/paper-material/paper-material.html" />
  <link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html" />
  <link rel="import" href="../../../bower_components/paper-toolbar/paper-toolbar.html" />
  <link rel="import" href="../../../bower_components/paper-item/paper-item.html" />
  <link rel="import" href="../../../bower_components/paper-item/paper-icon-item.html" />
  <link rel="import" href="../../../bower_components/paper-item/paper-item-body.html" />


  <template>
    <style>
      paper-material {
        box-sizing: border-box;
        width: calc(100% - 2rem);
        margin: 1rem;
        background-color: #fff;
      }

      a {
        display: block;
        color: inherit;
        text-decoration: none;
        width: 100%;
      }

      a:hover {
        background-color: var(--light-primary-color);
      }
      a:hover paper-item{
        color: var(--primary-color);
      }

    </style>
    <paper-header-panel>
      <paper-toolbar>
        <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
        <h1 class="paper-font-title flex-1">Recursos</h1>
        <paper-icon-button icon="search"></paper-icon-button>
        <paper-icon-button icon="refresh" on-click="refresh"></paper-icon-button>
      </paper-toolbar>

      <div>
        <paper-material elevation="1">
          <template is="dom-repeat" items="[[resources]]">
            <a href="[[_hrefItem(item)]]">
              <paper-item>
                <paper-item-body two-line>
                  <div>[[item.name]]</div>
                  <div secondary>
                    Descritores:
                    <template is="dom-repeat" items="[[item.tags]]" as="tag">
                      <span>[[tag.name]]</span>
                    </template>
                  </div>
                </paper-item-body>
              </paper-item>
            </a>
          </template>
        </paper-material>
      </div>
    </paper-header-panel>

    <iron-ajax id="ajax-resource" url="http://localhost:3000/api/Resources" method="GET" handle-as="json"
    on-response="_handleResourceResponse"></iron-ajax>
  </template>
  <script>
    (function() {
      Polymer({
        is: 'resource-view-list',

        properties: {
          resources: {
            type: Array,
            value: function() {
              return [];
            }
          }
        },

        /**
         * Creates a resource.
         *
         */
        refresh: function() {
          this.$['ajax-resource'].params = {
            'filter': JSON.stringify({
              "include": ["tags"]
            })
          }
          this.$['ajax-resource'].generateRequest();

        },

        _handleResourceResponse: function() {
          var resources = this.$['ajax-resource'].lastResponse;
          this.resources = resources;
        },

        _hrefItem: function(item) {
          console.log(item);
          return '/resource/view/' + item.id;
        },
      });
    })();

  </script>
</dom-module>
